---
title: "Project title"
subtitle: "STA/ISS 313 - Project 1"
author: "Team Name"
format: html
editor: visual
---

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

## Question 1: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

After investigating the differences in revenue and expenditure for men and women in our first plot, we are also interested in investigating and analyzing how the relationship between profit and expenditure differ for men and women and whether the sport is basketball or other. To address this difference in relationship, we plan to create a separate scatter plot for men and women, colored by sports. We decided to use a scatter plot because we want to visualize and analyze the relationship between two quantitative variables. We also plan to add a best trend line through the data points to get a better visualization of the strength of relationship between profit and expenditure. Additionally, to further analyze how the relationship between profit and expenditure differ between men and women, we plan to calculate the correlation coefficient for each gender and compare them to see which correlation coefficient is higher.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}
library(tidyverse)
library(plyr)
library(patchwork)
sports <- read.csv("data/data.csv")

mens_rev <- sports %>%
  drop_na(rev_men) %>%
  group_by(year) %>%
  summarise(mean_rev_men = mean(rev_men))

womensrev <- sports %>%
  drop_na(rev_women) %>%
  group_by(year) %>%
  summarise(mean_rev_women = mean(rev_women))

mensexp <- sports %>%
  drop_na(exp_men) %>%
  group_by(year) %>%
  summarise(mean_exp_men = mean(exp_men))

womensexp <- sports %>%
  drop_na(exp_women) %>%
  group_by(year) %>%
  summarise(mean_exp_women = mean(exp_women))

plotdf <- mensrev %>%
  left_join(mensexp) %>%
  left_join(womensrev) %>%
  left_join(womensexp)

plotdf_pivoted <- plotdf %>% 
  pivot_longer(
    cols = c(mean_rev_men, mean_exp_men, mean_exp_women, mean_rev_women), 
    names_to = "category", 
    values_to = "amount"
  ) %>%
  mutate(gender = case_when(category == "mean_exp_men" | category == "mean_rev_men" ~ "Mens",
                            category == "mean_exp_women" | category == "mean_rev_women" ~ "Womens"),
         type = case_when(category == "mean_exp_men" | category == "mean_exp_women" ~ "Expenditure",
                            category == "mean_rev_men" | category == "mean_rev_women" ~ "Revenue"))

mensdata <- plotdf_pivoted %>%
  filter(gender == "Mens")
womensdata <- plotdf_pivoted %>%
  filter(gender == "Womens")
```

```{r}
ggplot() +
  geom_point(data = plotdf_pivoted, aes(x = year, y = amount, shape = type, color = gender), size = 3) +
  geom_line(data = mensdata, aes(x = year, y = amount, group = year), linetype = "dashed", color = "#F8766D") +
  geom_line(data = womensdata, aes(x = year, y = amount, group = year), linetype = "dashed", 
            color = "#619CFF") +
  scale_y_continuous(labels = label_dollar(suffix = "K", scale = 1e-3)) +
  labs(title = "Average college sports revenue and expenditure",
       subtitle = "By gender",
       y = "",
       x = "Year",
       color = "Gender",
       shape = "Type") +
  theme_minimal()  +
  theme(legend.position = "top")
```

```{r}
#| label: Q1-plot2-data-wrangling
#| message: false

# filter out NA values
sports_mini = sports |>
  filter(!is.na(exp_men), !is.na(exp_women), !is.na(rev_men), !is.na(rev_women)) 

# pivot to create a gender column
sports_pivot <- sports_mini |>
  pivot_longer(
    cols = c("exp_men", "exp_women", "rev_men", "rev_women"),
    names_to = c("type_money", "gender"),
    values_to = c("amount"),
    names_sep = "_"
  )

# filter for only observations with year as 2015
sports_pivot <- sports_pivot |>
  filter(year == 2015) 

# pivot wider to create a separate column for revenue and expenditure
sports_pivot <- sports_pivot |>
  pivot_wider(
    names_from = type_money,
    values_from = amount
  )

# create a profit variable
sports_pivot <- sports_pivot |>
  mutate(
    profit = rev - exp
  )

# create separate data frame for only women
sports_pivot_women <- sports_pivot |>
  filter(gender == "women") 

# spotlight extreme outlier in women's data frame so we can remove it
sports_pivot_women |>
  filter(profit > 15000000)

# mutate sports with values Basketball or Other
sports_pivot_women <- sports_pivot_women |>
  filter(profit < 15000000) |>
  mutate(
    sports =
      case_when(
        sports == "Basketball" ~ "Basketball",
        TRUE ~ "Other"
      )
  ) 

# create separate data frame for only men
sports_pivot_men <- sports_pivot |>
  filter(gender == "men") 

# mutate sports with values Basketball or Other
sports_pivot_men <- sports_pivot_men |>
  filter(profit < 15000000) |>
  mutate(
    sports =
      case_when(
        sports == "Basketball" ~ "Basketball",
        TRUE ~ "Other"
      )
  ) 

```

```{r}
#| label: Q1-plot2-correlation-coeff
# calculate the correlation coefficient for each gender and create a data frame
# to store the values
cors <- ddply(sports_pivot, c("gender"), summarise, cor = round(cor(exp, profit), 2))
```

```{r}
#| label: Q1-plot2-scatter-plots
#| message: false

# scatter plot for women
plot1 <- ggplot(sports_pivot_women, aes(x = exp, y = profit, color = sports)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "black") +
  geom_hline(yintercept = 0, linetype = 2) +
  labs(
    title = "Relationship Between Profit and Expenditure for Basketball and Other Sports\nfor Women",
    subtitle = "in 2015",
    x = "Expenditure ($)",
    y = "Profit ($)",
    color = "Sport Type"
  ) +
  annotate(geom = "label", x = 0.5e+06, y = 3000000, label = "r = -0.57", size = 5,
           color = "black", fontface = 2) +
  annotate(geom = "text", x = 8e+06, y = 500000, label = "Profit = 0") +
  coord_cartesian(clip = "off", ylim = c(-5100000, 4000000)) +
  scale_y_continuous(breaks = c(-5000000, -2500000, 0, 2500000),
                     labels = c("$-5M", "$-2.5M", "$0M", "$2.5M")) +
  scale_x_continuous(breaks = c(0e+00, 2e+06, 4e+06, 6e+06),
                     labels = c("$0M", "$2M", "$4M", "$6M")) +
  scale_color_manual(values = c("#8E7DBE", "#D88C9A")) +
  theme_minimal() +
  theme(
    legend.position = c(0.9, 0.9),
    legend.box.background = element_rect(fill = "white", color = "black")
  )

# scatter plot for men
plot2 <- ggplot(sports_pivot_men, aes(x = exp, y = profit, color = sports)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "black") +
  geom_hline(yintercept = 0, linetype = 2) +
  labs(
    title = "Relationship Between Profit and Expenditure for Basketball and Other Sports\nfor Men",
    subtitle = "in 2015",
    x = "Expenditure ($)",
    y = "Profit ($)",
    color = "Sport Type"
  ) +
  annotate(geom = "label", x = 1.2e+06, y = 2.5e+07, label = "r = 0.54", size = 5,
           color = "black", fontface = 2) +
  annotate(geom = "text", x = 2e+07, y = 1.5e+06, label = "Profit = 0") +
  coord_cartesian(clip = "off", ylim = c(-5000000, 30000000)) +
  scale_x_continuous(breaks = c(0.0+00, 5.0e+06, 1.0e+07, 1.5e+07), 
                     labels = c("$0M", "$5M", "$10M", "$15M")) +
  scale_y_continuous(breaks = c(0.0+00, 1e+07, 2e+07, 3e+07, 4e+07), 
                     labels = c("$0M", "$10M", "$20M", "$30M", "$40M")) +
  scale_color_manual(values = c("#8E7DBE", "#D88C9A")) +
  theme_minimal() +
  theme(
    legend.position = c(0.9, 0.9),
    legend.box.background = element_rect(fill = "white", color = "black")
  )

plot1
plot2
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

From the two graphs, we can see that the relationship between profit and expenditure differs greatly for men and women. For men, there appears to be a moderate positive relationship between profit and expenditure while for women there appears to be a moderate negative relationship between profit and expenditure. This trend is probably because although colleges spend millions of dollars in funding for women collegiate sport programs, these women collegiate sport programs do not generate enough revenue for positive profit. This is most likely due to women collegiate programs obtaining less publicity in corporate sponsorship and media viewership, according to the NPR article on unequal profits. It is reasonably expected that the relationship between profit and expenditure is positive as shown in men's collegiate sports programs; however, this is not the case for women collegiate sports programs since external uncontrollable factors such as media viewership and corporate sponsorship influence how much revenue and thus profit is generated from advertisement, ticket sales, and sponsorships.

The magnitude of the r-squared value 0.57 for women is slightly greater than 0.54 for men. This means that the relationship for profit and expenditure for women follow more of a linear relationship than for men. This can be due to women's collegiate sports often times displaying a consistent trend in generating low profits for an increase in expenditure because of the collegiate sports' industry of underlying gender bias and discrimination. This relationship for men is less linearly correlated and shows more spread because different schools and divisions will have more promising teams than other schools and divisions which influences the profit generated from expenditures.

Interestingly, the relationship between profit and expenditure for basketball is positive and stronger than the relationship between profit and expenditure for other sports where the relationship is negative. This makes sense because men's collegiate basketball is one of the most popular collegiate sport that generates enormous amounts of publicity and profit. However, for women, no matter the type of sport, the relationship between profit and expenditure is negative and similar. This similarity in trend for all sports for women shows that there might be some underlying gender discrimination and under-representation in terms of profitable opportunities in collegiate sports for women.

## Question 2: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

Public universities tend to outperform private universities in football games. Nevertheless, based on the initial visualization, it was discovered that private universities allocate more funds for this sport than their public counterparts. Consequently, we conducted further analysis on the data distribution of the two major university sports, namely basketball and football. These sports were chosen due to their large number of data points. To display the distributions, we employed box plots that were facet-wrapped by sports and color-coded according to the type of university, whether public or private.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}
library(scales)
#| label: Question 2 Part 2 data wrangling
q2_2 <- sports %>% 
  filter(classification_code == 1 & (sports == "Basketball" | sports == "Football") ) %>% 
  select(sports, sector_name, total_exp_menwomen) %>% 
  mutate(sector_name = recode(sector_name, "Private nonprofit, 4-year or above" = "Private", "Public, 4-year or above" = "Public")) #renaming sector name values, so thatt it will look nice on the graph

```

```{r}
#| label: Question 2 Part 2 data visualization

ggplot(
  q2_2, 
  aes(y = total_exp_menwomen, color = sector_name)
) +
  geom_boxplot() + #creating a boxplot
  scale_y_continuous(labels = label_number(prefix = "$", suffix = "M", scale = 1e-6)) + #fixing the y axis labels
  facet_wrap(~ sports, strip.position = "bottom") + #facet wrapping by sports
  theme_minimal() +
  labs( 
    y = "Total expenditure",
    title = "Total Expenditures of Private and Public Universities", 
    subtitle = "On Basketball and Football in 2015-2019"
  ) +
  theme(
    axis.text.x=element_blank(),
    axis.ticks.x = element_blank(),
    legend.position = c(0.2, 0.8),
    legend.box.background = element_rect(fill = "white",
                                         color = "white"),
    legend.title = element_blank()
  ) 
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

```{r}
library(tidyverse)
sports <- read.csv("data/data.csv")
library(janitor)
class_sports<- sports %>% 
  filter(classification_code== 1) 

d1_priv_pub <- class_sports %>% 
  group_by(sports, sector_name) %>% 
  mutate(mean_exp = mean(total_exp_menwomen, na.rm = TRUE),
         mean_rev = mean(total_rev_menwomen, na.rm = TRUE),
         profit = mean_rev - mean_exp) %>% 
  ungroup()

priv_pub <- d1_priv_pub %>% 
  filter(year == 2015) %>% 
  select(sports, mean_exp, mean_rev, profit, sector_name) %>% 
  distinct() %>% 
  mutate(mean_exp = ifelse(sector_name == "Public, 4-year or above", -mean_exp,
                           mean_exp),
         mean_rev = ifelse(sector_name == "Public, 4-year or above", -mean_rev,
                           mean_rev)) 
rem <- c("Track and Field, Indoor", "Squash", "Track and Field, X-Country",
         "Track and Field, Outdoor", "Other Sports",
         "Synchronized Swimming", "Diving",
         "Bowling", "Sailing", "Skiing", "Rifle", "Equestrian")
pivot_priv <- priv_pub %>% 
  select(mean_exp, sector_name, sports) %>% 
  pivot_wider(names_from = sector_name,
              values_from = mean_exp) %>% 
  clean_names() %>% 
  mutate(difference = public_4_year_or_above + 
           private_nonprofit_4_year_or_above,
         difference_abs = abs(difference)) %>% 
  mutate(out_spend = ifelse(difference >0, "Private", "Public")) %>% 
  filter(!(sports %in% rem))
```

```{r}
library(scales)
ggplot(pivot_priv, aes(x = difference, y = fct_reorder(sports, difference), 
                       fill = out_spend))+
  geom_bar(stat= "identity")+
    scale_x_continuous(labels = dollar_format(scale = 1e-6, prefix = "$", 
                                            suffix = "M"))+
  labs(x = "Difference in Expenditure",
       y = "Sport",
       fill = "Bigger Spender?",
       title = "What Sports do Public and Private Division 1 Schools Outspend 
       Each Other")+
  scale_fill_viridis_d()+
  theme_minimal()
```

The second visualization indicates that private universities spend more on football than public universities, with a noticeable difference in median expenditure. This implies that half of all public universities allocate less funding to football compared to half of all private universities. However, there are multiple exceptions within the public universities, as some spend more than private universities, which may be attributed to their success in football. Despite the significant difference in the first plot, we found out from this visualization that there are some public universities that spend more on football than private ones. On the other hand, for basketball, there is no significant difference in median expenditure between public and private universities. Nonetheless, public universities have a bit wider range of expenditure on basketball than private universities. Overall, universities tend to allocate more funding to football than basketball.
